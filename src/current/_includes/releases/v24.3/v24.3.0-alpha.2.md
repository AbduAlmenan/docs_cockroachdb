## v24.3.0-alpha.2

Release Date: October 14, 2024

{% include releases/new-release-downloads-docker-image.md release=include.release %}
<h3 id="v24-3-0-alpha-2-security-updates">Security updates</h3>

- HBA config entry for LDAP will be evaluated with validations for proper ldap config parameter values and any invalid/incomplete options list will be disallowed to amend the HBA setting. We will validate all fields provided as ldap auth method options in HBA entry. [#132086][#132086]

<h3 id="v24-3-0-alpha-2-general-changes">General changes</h3>

- Change the license cockroach is distributed under to the new CockroachDB Software License (CSL). [#131799][#131799]
- Change the license cockroach is distributed under to the new CockroachDB Software License (CSL). [#131794][#131794]
- Change the license cockroach is distributed under to the new CockroachDB Software License (CSL). [#131793][#131793]

<h3 id="v24-3-0-alpha-2-{{-site.data.products.enterprise-}}-edition-changes">{{ site.data.products.enterprise }} edition changes</h3>

- Allowed access to DB console APIs via JWT, which can be supplied as a Bearer token in Authorization header. [#130779][#130779]

<h3 id="v24-3-0-alpha-2-sql-language-changes">SQL language changes</h3>

- Added SHOW TYPES WITH COMMENT functionality similar to show schemas, show databases and show tables;  Fixes: https://github.com/cockroachdb/cockroach/issues/126009 [#131183][#131183]
- Added support for `SECURITY DEFINER` in user defined functions (UDFs) and stored procedures (SPs). When a UDF/SP (routine) is created with `SECURITY DEFINER`, at execution, the privileges of the owner will be checked.  Routines can now specify `[EXTERNAL] SECURITY INVOKER` (this is the default -- privileges of the invoker are checked at execution) or `[EXTERNAL] SECURITY DEFINER`. Note that the `EXTERNAL` keyword is optional and solely exists for sql conformity.  In addition, altering a UDF's security "mode" is accomplished by: `ALTER FUNCTION ... [EXTERNAL] SECURITY {INVOKER/DEFINER}`. [#129720][#129720]

<h3 id="v24-3-0-alpha-2-operational-changes">Operational changes</h3>

- Metrics representing the state of the replication flow control send queue's are added, which when the following settings are set to:  ``` kvadmission.flow_control.mode = "apply_to_all" kvadmission.flow_control.enabled = true ```  Will be populated using the corresponding replication admission control send queue state. Also note, the disconnected metric name is renamed, see the commit message and the metric name diff below for further information.  ```diff diff --git a/pkg/kv/kvserver/kvflowcontrol/rac2/testdata/simulation/metric_names b/pkg/kv/kvserver/kvflowcontrol/rac2/testdata/simulation/metric_names index c0b4755f1eb..96b237bb57f 100644 --- a/pkg/kv/kvserver/kvflowcontrol/rac2/testdata/simulation/metric_names +++ b/pkg/kv/kvserver/kvflowcontrol/rac2/testdata/simulation/metric_names @@ -20,6 +20,12 @@ kvflowcontrol.eval_wait.regular.requests.admitted  kvflowcontrol.eval_wait.regular.requests.bypassed  kvflowcontrol.eval_wait.regular.requests.errored  kvflowcontrol.eval_wait.regular.requests.waiting +kvflowcontrol.range_controller.count +kvflowcontrol.send_queue.bytes +kvflowcontrol.send_queue.count +kvflowcontrol.send_queue.prevent.count +kvflowcontrol.send_queue.scheduled.deducted_bytes +kvflowcontrol.send_queue.scheduled.force_flush  kvflowcontrol.streams.eval.elastic.blocked_count  kvflowcontrol.streams.eval.elastic.total_count  kvflowcontrol.streams.eval.regular.blocked_count @@ -30,21 +36,24 @@ kvflowcontrol.streams.send.regular.blocked_count  kvflowcontrol.streams.send.regular.total_count  kvflowcontrol.tokens.eval.elastic.available  kvflowcontrol.tokens.eval.elastic.deducted -kvflowcontrol.tokens.eval.elastic.disconnected  kvflowcontrol.tokens.eval.elastic.returned +kvflowcontrol.tokens.eval.elastic.returned.disconnect  kvflowcontrol.tokens.eval.elastic.unaccounted  kvflowcontrol.tokens.eval.regular.available  kvflowcontrol.tokens.eval.regular.deducted -kvflowcontrol.tokens.eval.regular.disconnected  kvflowcontrol.tokens.eval.regular.returned +kvflowcontrol.tokens.eval.regular.returned.disconnect  kvflowcontrol.tokens.eval.regular.unaccounted  kvflowcontrol.tokens.send.elastic.available  kvflowcontrol.tokens.send.elastic.deducted -kvflowcontrol.tokens.send.elastic.disconnected +kvflowcontrol.tokens.send.elastic.deducted.force_flush_send_queue +kvflowcontrol.tokens.send.elastic.deducted.prevent_send_queue  kvflowcontrol.tokens.send.elastic.returned +kvflowcontrol.tokens.send.elastic.returned.disconnect  kvflowcontrol.tokens.send.elastic.unaccounted  kvflowcontrol.tokens.send.regular.available  kvflowcontrol.tokens.send.regular.deducted -kvflowcontrol.tokens.send.regular.disconnected +kvflowcontrol.tokens.send.regular.deducted.prevent_send_queue  kvflowcontrol.tokens.send.regular.returned +kvflowcontrol.tokens.send.regular.returned.disconnect  kvflowcontrol.tokens.send.regular.unaccounted ``` [#131857][#131857]

<h3 id="v24-3-0-alpha-2-db-console-changes">DB Console changes</h3>

- The table details page has been updated to show cached data in the overview page, which is the same data source as what is shown in the databases and databases > tables list overview pages. [#131769][#131769]

<h3 id="v24-3-0-alpha-2-bug-fixes">Bug fixes</h3>

- Fixed a bug where the CLI would not correctly escape JSON values that had double-quotes inside of a string when using the --format=sql flag. [#131881][#131881]
- Fixed an error that could happen if an aggregate function was used as the value in a SET command. [#131891][#131891]
- Fix a rare bug in which an update of a primary key column which is also the only column in a separate column family can sometimes fail to update the primary index. This bug has existed since v22.2. [#131869][#131869]
- Ordering by `VECTOR` columns now results in an "unimplemented" error. Previously it would result in internal errors in some cases. See #92165. [#131703][#131703]
- Add automated clean-up/validation for dropped roles inside of default privileges. [#131782][#131782]
- Addressed a rare bug where dropping a column of FLOAT4/8, DECIMAL, JSON, collated string type, or array types that were stored in a single column family could make a table unreadable (if the column family is not the first one). [#131967][#131967]

<h3 id="v24-3-0-alpha-2-performance-improvements">Performance improvements</h3>

- The system now more efficiently writes string-like values in the pgwire protocol. [#131964][#131964]
- Enhanced performance when schema_locked is not in use by improving error handling during periodic table history polling.  ``` ❯ benchstat before.txt after.txt goos: darwin goarch: arm64                                         │  before.txt  │              after.txt               │                                         │    sec/op    │    sec/op     vs base                │ PauseOrResumePolling/non-terminal_error    5.533µ ± 5%   3.849µ ± 29%  -30.44% (p=0.000 n=10) PauseOrResumePolling/not_schema_locked    7069.5n ± 4%   176.4n ±  9%  -97.50% (p=0.000 n=10) PauseOrResumePolling/schema_locked         136.2n ± 4%   131.8n ±  7%        ~ (p=0.306 n=10) geomean                                    1.747µ        447.2n        -74.39% ``` [#131951][#131951]

<h3 id="v24-3-0-alpha-2-miscellaneous">Miscellaneous</h3>

<h4 id="v24-3-0-alpha-2-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#132100][#132100] [2d4df70a8][2d4df70a8] drtprod: put roachtest binary and operation script in workload-scale
- [#131827][#131827] [5e44c3e68][5e44c3e68] roachprod, azure: combine location and zone flags
- [#131805][#131805] [86cd9acda][86cd9acda] cli: {2} is reserved tenant ID, use {3} as tenant ID for demoapp
- [#131714][#131714] [e6440862e][e6440862e] span: fix corruption bug in btree span frontier

<h3 id="v24-3-0-alpha-2-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}



[#129720]: https://github.com/cockroachdb/cockroach/pull/129720
[#130779]: https://github.com/cockroachdb/cockroach/pull/130779
[#131183]: https://github.com/cockroachdb/cockroach/pull/131183
[#131703]: https://github.com/cockroachdb/cockroach/pull/131703
[#131714]: https://github.com/cockroachdb/cockroach/pull/131714
[#131769]: https://github.com/cockroachdb/cockroach/pull/131769
[#131782]: https://github.com/cockroachdb/cockroach/pull/131782
[#131793]: https://github.com/cockroachdb/cockroach/pull/131793
[#131794]: https://github.com/cockroachdb/cockroach/pull/131794
[#131799]: https://github.com/cockroachdb/cockroach/pull/131799
[#131805]: https://github.com/cockroachdb/cockroach/pull/131805
[#131827]: https://github.com/cockroachdb/cockroach/pull/131827
[#131857]: https://github.com/cockroachdb/cockroach/pull/131857
[#131869]: https://github.com/cockroachdb/cockroach/pull/131869
[#131881]: https://github.com/cockroachdb/cockroach/pull/131881
[#131891]: https://github.com/cockroachdb/cockroach/pull/131891
[#131951]: https://github.com/cockroachdb/cockroach/pull/131951
[#131964]: https://github.com/cockroachdb/cockroach/pull/131964
[#131967]: https://github.com/cockroachdb/cockroach/pull/131967
[#132086]: https://github.com/cockroachdb/cockroach/pull/132086
[#132100]: https://github.com/cockroachdb/cockroach/pull/132100
[2d4df70a8]: https://github.com/cockroachdb/cockroach/commit/2d4df70a8
[5e44c3e68]: https://github.com/cockroachdb/cockroach/commit/5e44c3e68
[86cd9acda]: https://github.com/cockroachdb/cockroach/commit/86cd9acda
[e6440862e]: https://github.com/cockroachdb/cockroach/commit/e6440862e
