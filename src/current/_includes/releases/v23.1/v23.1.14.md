## v23.1.14

Release Date: January 17, 2024

{% include releases/release-downloads-docker-image.md release=include.release %}

<h3 id="v23-1-14-sql-language-changes">SQL language changes</h3>

- CockroachDB now supports [`IMPORT INTO`](https://www.cockroachlabs.com/docs/v23.1/import-into) a table that has columns typed as arrays of user-defined types (such as enums). Tables that use multiple user-defined types with the same name but different schemas are still unsupported. [#116361][#116361]
- Added a new field, `StmtPosInTxn`, to the `CommonSQLExecDetails` (included in SQL audit logs, SQL execution logs, and telemetry events) to represent the statement's index in the transaction, starting at 1. [#116558][#116558]

<h3 id="v23-1-14-operational-changes">Operational changes</h3>

- Updated the [`changefeed.lagging_ranges_threshold`](https://www.cockroachlabs.com/docs/v23.1/cluster-settings#settings) and [`changefeed.lagging_ranges_polling_interval`](https://www.cockroachlabs.com/docs/v23.1/cluster-settings#settings) cluster settings. [#115803][#115803]

<h3 id="v23-1-14-db-console-changes">DB Console changes</h3>

- The [**Cluster Overview** page](https://www.cockroachlabs.com/docs/v23.1/ui-cluster-overview-page) now correctly renders the background color for email signups, fixing an issue where it was difficult to read the text. [#114546][#114546]
- Resolved inconsistency in TimeScale component's **Now** button behavior, ensuring accurate chart updates even after custom time range selection. [#115513][#115513]
- Updated the **CPU Time** label to **SQL CPU Time** on the [DB Console](https://www.cockroachlabs.com/docs/v23.1/ui-overview-dashboard) and clarified the tooltip. [#116448][#116448]
- Fixed an issue where all `AggHistogram`-powered metrics were not reporting quantiles properly in the [DB Console](https://www.cockroachlabs.com/docs/v23.1/ui-overview-dashboard). The list of affected metrics is:  
    - `changefeed.message_size_hist` 
    - `changefeed.parallel_io_queue_nanos` 
    - `changefeed.sink_batch_hist_nanos` 
    - `changefeed.flush_hist_nanos` 
    - `changefeed.commit_latency` 
    - `changefeed.admit_latency` 
    - `jobs.row_level_ttl.span_total_duration` 
    - `jobs.row_level_ttl.select_duration` 
    - `jobs.row_level_ttl.delete_duration`  

    Note that these histograms were only broken in the DB Console metrics features, but were not broken in the Prometheus-compatible endpoint, `/_status/vars`. [#114747][#114747]
- In the **SQL Activity Transaction Details** page, users can now view a transaction fingerprint ID across multiple applications by specifying the app name in the `appNames` URL search parameter using a comma-separated encoded string of transaction fingerprint IDs. [#116102][#116102]

<h3 id="v23-1-14-bug-fixes">Bug fixes</h3>

- Fixed a bug where an active replication report update could get stuck in a retry loop on clusters with over 10000 ranges, which would prevent a node from shutting down cleanly. [#114242][#114242]
- Fixed error handling for `GetFiles` so that it does not cause a nil pointer dereference. [#114829][#114829]
- Fixed a bug that prevented the **SQL Activity** page from showing internal statements when the `sql.stats.response.show_internal.enabled` [cluster setting](https://www.cockroachlabs.com/docs/v23.1/cluster-settings) was set to `true`. [#114819][#114819]
- Rolled back deletes no longer cause a discrepancy between computed stats and the actual stored values. [#113772][#113772]
- Previously, CockroachDB could encounter an internal error when using the text format (as opposed to binary) when preparing statements with user-defined composite types. The bug was introduced in 23.1 and is now fixed. [#115063][#115063]
- Fixed a bug that could cause cluster version finalization to contend with descriptor lease renewals on large clusters. Descriptor lease renewals previously had a higher priority than cluster upgrade finalization. Finalization now always has a higher priority than descriptor lease renewal. [#114672][#114672]
- Fixed a bug that would cause a [prepared statement](https://www.cockroachlabs.com/docs/v23.1/sql-grammar#prepare_stmt) to fail if it references an enum as well as a table that has undergone a schema change. [#115174][#115174]
- [Backups](https://www.cockroachlabs.com/docs/v23.1/backup) now evenly distribute their work across all replicas, including followers, regardless of leaseholder placement. [#115018][#115018]
- Replica processing in store queues has been enhanced to smoothly handle replicas that have undergone ID changes or destruction. These replicas can now be effectively re-added and processed without encountering previous purgatory-related issues. [#115036][#115036]
- Fixed an issue that could lead to stuck queries or inaccurate results when using lookup [joins](https://www.cockroachlabs.com/docs/v23.1/joins) involving equality columns and multiple ranges. The bug was introduced in 22.2 and is now fixed. [#115581][#115581]
- [`CREATE INDEX`](https://www.cockroachlabs.com/docs/v23.1/create-index) with expressions no longer fail on materialized [views](https://www.cockroachlabs.com/docs/v23.1/views) when the declarative schema changer is used. [#115596][#115596]
- Fixed a bug that could result in an incorrect "too few columns" error for queries that use `ANY <array>` syntax with a subquery. [#115591][#115591]
- Fixed a bug that could cause "too few/many columns" errors for queries that used `IN` or `NOT IN` with a non-trivial right operand, such as a subquery (rather than a constant tuple). [#115591][#115591]
- Fixed a bug that could cause errors or inaccurate results when performing lookup and index [joins](https://www.cockroachlabs.com/docs/v23.1/joins) on tables with three or more column families. The bug was introduced in 22.2 and is now fixed. [#115899][#115899]
- Fixed a bug that could cause internal errors or panics while attempting to forecast statistics on a numeric column. [#115899][#115899]
- [`BEGIN`](https://www.cockroachlabs.com/docs/v23.1/begin-transaction) statement logs now have correct query `Age` fields. Previously, these fields were being recorded incorrectly, which would lead to some statements also appearing erroneously in the slow query logs. [#115257][#115257]
- SQL stats in the UI now correctly reflect total runtime, resolving a calculation error that previously led to values exceeding 100%. [#117497][#117497]
- Custom key column now functions with [change data capture queries](https://www.cockroachlabs.com/docs/v23.1/cdc-queries) correctly. For example, `CREATE CHANGEFEED WITH key_column=..., unordered AS SELECT * FROM table` now works correctly instead of retrying forever. Note that some functionalities with CDC custom keys are not fully supported, see 115267 for more details. [#117555][#117555]

<h3 id="v23-1-14-performance-improvements">Performance improvements</h3>

- Reduced query planning time significantly for some queries which join multiple tables. [#114512][#114512][#116107][#116107]

<div class="release-note-contributors" markdown="1">

<h3 id="v23-1-14-contributors">Contributors</h3>

This release includes 128 merged PRs by 42 authors.
We would like to thank the following contributors from the CockroachDB community:

- Matthew Sanabria (first-time contributor)
- rharding6373

</div>

[#113772]: https://github.com/cockroachdb/cockroach/pull/113772
[#114242]: https://github.com/cockroachdb/cockroach/pull/114242
[#114512]: https://github.com/cockroachdb/cockroach/pull/114512
[#114546]: https://github.com/cockroachdb/cockroach/pull/114546
[#114672]: https://github.com/cockroachdb/cockroach/pull/114672
[#114747]: https://github.com/cockroachdb/cockroach/pull/114747
[#114819]: https://github.com/cockroachdb/cockroach/pull/114819
[#114829]: https://github.com/cockroachdb/cockroach/pull/114829
[#115018]: https://github.com/cockroachdb/cockroach/pull/115018
[#115036]: https://github.com/cockroachdb/cockroach/pull/115036
[#115063]: https://github.com/cockroachdb/cockroach/pull/115063
[#115174]: https://github.com/cockroachdb/cockroach/pull/115174
[#115257]: https://github.com/cockroachdb/cockroach/pull/115257
[#115513]: https://github.com/cockroachdb/cockroach/pull/115513
[#115581]: https://github.com/cockroachdb/cockroach/pull/115581
[#115591]: https://github.com/cockroachdb/cockroach/pull/115591
[#115596]: https://github.com/cockroachdb/cockroach/pull/115596
[#115603]: https://github.com/cockroachdb/cockroach/pull/115603
[#115803]: https://github.com/cockroachdb/cockroach/pull/115803
[#115899]: https://github.com/cockroachdb/cockroach/pull/115899
[#116102]: https://github.com/cockroachdb/cockroach/pull/116102
[#116107]: https://github.com/cockroachdb/cockroach/pull/116107
[#116361]: https://github.com/cockroachdb/cockroach/pull/116361
[#116448]: https://github.com/cockroachdb/cockroach/pull/116448
[#116517]: https://github.com/cockroachdb/cockroach/pull/116517
[#116558]: https://github.com/cockroachdb/cockroach/pull/116558
[#117497]: https://github.com/cockroachdb/cockroach/pull/117497
[#117555]: https://github.com/cockroachdb/cockroach/pull/117555
[d27790ece]: https://github.com/cockroachdb/cockroach/commit/d27790ece
