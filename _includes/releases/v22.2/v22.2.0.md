## v22.2.0

Release Date: December 5, 2022

With the release of CockroachDB v22.2, we've added new capabilities in CockroachDB to help you build, optimize, and operate more effectively and efficiently. Check out a [summary of the most significant user-facing changes](#v22-2-0-feature-highlights) and then [upgrade to CockroachDB v22.2](../v22.2/upgrade-cockroach-version.html).

For demos and videos on the new features, see the [v22.2 page](https://www.cockroachlabs.com/22-2-launch). [Join our webinar](http://cockroachlabs.com/webinars/maximize-queries-per-second-with-distributedsql) on schema design and query tuning in a distributed SQL database.

{% include releases/release-downloads-docker-image.md release=include.release %}

<h3 id="v22-2-0-{{ site.data.products.db | downcase | replace: " ", "-" }}">{{ site.data.products.db }}</h3>

- <a href="https://cockroachlabs.cloud/signup?referralId=docs_crdb_release_notes" rel="noopener" target="_blank">Get a free v22.2 cluster on {{ site.data.products.serverless }}</a>.
- Learn about recent updates to {{ site.data.products.db }} in the [{{ site.data.products.db }} Release Notes](cloud.html).

<h3 id="v22-2-0-feature-highlights">Feature highlights</h3>

This section summarizes the most significant user-facing changes in v22.2.0. For a complete list of features and changes, including bug fixes and performance improvements, see the [release notes](index.html#testing-releases) for previous testing releases. You can also search for [what's new in v22.2 in our docs](../search.html?query=new%20in%20v22.2).

{{site.data.alerts.callout_info}}
The features highlighted below are freely available in {{ site.data.products.core }} and do not require an [enterprise license](https://www.cockroachlabs.com/get-cockroachdb/enterprise/), unless otherwise noted. [{{ site.data.products.db }} clusters](https://cockroachlabs.cloud/) include all enterprise features. You can also use [`cockroach demo`](../v22.2/cockroach-demo.html) to test enterprise features in a local, temporary cluster.
{{site.data.alerts.end}}

- [Streamline how you build](#v22-2-0-streamline-how-you-build)
- [Move data between systems](#v22-2-0-move-data-between-systems)
- [Improve application performance without downtime](#v22-2-0-improve-application-performance-without-downtime)
- [Protect your data](#v22-2-0-protect-your-data)
- [Backward-incompatible changes](#v22-2-0-backward-incompatible-changes)
- [Deprecations](#v22-2-0-deprecations)
- [Known limitations](#v22-2-0-known-limitations)
- [Additional resources](#v22-2-0-additional-resources)

<style>
    table td:first-child {
        min-width: 100px !important;
    }
    table td:nth-child(2) {
        min-width: 200px !important;
    }
</style>

<h4 id="v22-2-0-streamline-how-you-build">Streamline how you build</h4>

 Feature                                                       | Description
---------------------------------------------------------------+----------------
[User-defined functions (UDFs)](../v22.2/user-defined-functions.html) | Migrate existing workloads that use [UDFs](../v22.2/user-defined-functions.html) to CockroachDB without the need to change them. CockroachDB supports invoking UDFs in `SELECT`, `FROM`, and `WHERE` clauses of [DML statements](../v22.2/sql-statements.html#data-manipulation-statements).
[CockroachDB MOLT (Migrate Off Legacy Technology)](../cockroachcloud/migrations-page.html) | Use the [Schema Conversion Tool](../cockroachcloud/migrations-page.html) on the CockroachDB Cloud Console to analyze your schema for SQL incompatibilities. The tool will identify and help you resolve errors in your schema, and then create a new CockroachDB database with the converted schema.
[Trigram indexes](../v22.2/trigram-indexes.html)               | You can now perform text search directly within CockroachDB with [trigram indexes](../v22.2/trigram-indexes.html). Trigram indexes enable "fuzzy"  search (i.e., match a search term closely instead of exactly) within CockroachDB without the need to change your queries or set up complex full text search systems.
[PostgREST support](https://postgrest.org/en/stable/tutorials/tut0.html) | You can now perform basic CRUD operations in CockroachDB using a REST API with new support for the open source tool [PostgREST](https://postgrest.org/en/stable/tutorials/tut0.html). Docs coming soon.
Hasura integration                                             | CockroachDB’s new integration with Hasura minimizes the time required to build APIs, secure access, deploy and scale the app server, and optimize performance. Hasura acts as a middleware for translating GraphQL queries into SQL and provides an easy way to offer GraphQL functionality, so you don’t have to write application logic for these capabilities. In addition to GraphQL, Hasura also provides an easy way to build REST APIs on top of CockroachDB. Docs coming soon.
[Row-level TTL](../v22.2/row-level-ttl.html)                   | [Row-level TTL](../v22.2/row-level-ttl.html) is now generally available (GA). The GA release of TTL builds upon the existing functionality of setting the lifespan of data down to the row level. TTL performance is also improved, and there is now additional syntax to make calculating TTL expiration easier.

<h4 id="v22-2-0-move-data-between-systems">Move data between systems</h4>

 Feature                                                          | Description
------------------------------------------------------------------+-------------
[Change data capture (CDC) transformations](../v22.2/cdc-transformations.html) </br>(Preview, [{{ site.data.products.enterprise }}-only](../v22.2/enterprise-licensing.html))| [CDC transformations](../v22.2/cdc-transformations.html) simplify your event-based applications and data pipelines by letting you extract only the data you need from CockroachDB. You can use standard SQL expressions to specify up-front transformations to the data you want to stream to the rest of your system.
[CDC performance improvements](../v22.2/advanced-changefeed-configuration.html) </br>([{{ site.data.products.enterprise }}-only](../v22.2/enterprise-licensing.html)) | Get up to 9x faster [changefeed performance](../v22.2/advanced-changefeed-configuration.html) for certain workloads and setups on large volumes (terabytes) of data.

<h4 id="v22-2-0-improve-application-performance-without-downtime">Improve application performance without downtime</h4>

 Feature                                                        | Description
----------------------------------------------------------------+---------------
[Insights page](../v22.2/ui-insights-page.html)                 | The [Insights page](../v22.2/ui-insights-page.html) exposes problems that CockroachDB has detected in your workloads and schemas. The page helps you identify SQL statements with [high retry counts](../v22.2/transactions.html#automatic-retries), [slow execution](../v22.2/query-behavior-troubleshooting.html#identify-slow-queries), or [suboptimal plans](../v22.2/cost-based-optimizer.html). It also helps you identify [indexes](../v22.2/indexes.html) that should be created, altered, replaced, or dropped to improve performance.
[Invisible indexes](../v22.2/alter-index.html#index-visibility) | With [invisible indexes](../v22.2/alter-index.html#index-visibility), you can create and test indexes without affecting the overall application.

<h4 id="v22-2-0-protect-your-data">Protect your data</h4>

 Feature                                             | Description
-----------------------------------------------------+-------------
[Secondary regions](../v22.2/multiregion-overview.html#secondary-regions) | Use [secondary regions](../v22.2/multiregion-overview.html#secondary-regions) to specify which region the leaseholders move to in the event of a failure. Secondary regions let you improve latency during failures, plan better for outages, and routinely test failover scenarios without impacting performance.
[Backup validation](../v22.2/backup-validation.html) | CockroachDB provides [backup validation](../v22.2/backup-validation.html) tools to check that backups you have in storage are restorable.
[Private {{ site.data.products.dedicated }} clusters](../cockroachcloud/private-clusters.html) | Secure your {{ site.data.products.dedicated }} clusters with [private IPs](../cockroachcloud/private-clusters.html) to protect your data from potential threats. Updates to give your cluster end-to-end protection include the ability to secure clusters with only node-level private IPs, to access public external resources using a NAT Gateway, and to access cloud storage over your provider’s private connectivity.
[Egress perimeter controls on {{ site.data.products.dedicated }} clusters](../cockroachcloud/egress-perimeter-controls.html) </br>(Preview)| Use [egress perimeter controls](../cockroachcloud/egress-perimeter-controls.html) to reduce risk by configuring allowed external destinations for data. This new feature lets admins specify where users are allowed to send backups, data exports, changefeeds, etc. The virtual firewall capability significantly reduces the risk of data exfiltration and lets you restrict a cluster’s access to only organizationally allowed resources.
[Cloud cluster Single-Sign On (SSO)](../cockroachcloud/cloud-org-sso.html) </br>(Preview) | [Cluster SSO](../cockroachcloud/cloud-org-sso.html) lets application-level SQL identities use JWT tokens (Okta Service Accounts, GCP Service Accounts, Azure Managed Identities) to authenticate on {{ site.data.products.db }} clusters. SSO also lets SQL users access their cluster using the same SSO provider that you’ve already set up for the {{ site.data.products.db }} Console.
Role-Based Access Control (RBAC) for [backup](../v22.2/backup.html#required-privileges), [restore](../v22.2/restore.html#required-privileges), and [observability](../v22.2/ui-overview.html#role-based-security) | You can now inherit or combine task-specific permissions into SQL roles for [backup](../v22.2/backup.html#required-privileges), [restore](../v22.2/restore.html#required-privileges), and [observability](../v22.2/ui-overview.html#role-based-security). These roles can be assigned to relevant SQL users, to simplify management of access control and prevent escalation of privilege.
Role-Based Access Control (RBAC) for [CDC](../v22.2/create-changefeed.html#required-privileges) ([{{ site.data.products.enterprise }}-only](../v22.2/enterprise-licensing.html))| You can now inherit or combine task-specific permissions into SQL roles for [CDC](../v22.2/create-changefeed.html#required-privileges). These roles can be assigned to relevant SQL users to simplify management of access control and prevent escalation of privilege.
[Identity and Access Management (IAM) roles for bulk operations](../v22.2/use-cloud-storage-for-bulk-operations.html#assume-role-authentication) | Create secure [IAM roles](../v22.2/use-cloud-storage-for-bulk-operations.html#assume-role-authentication) in your cloud provider to access your cloud resources, so developers and operators can configure backups, restores, import, export, and CDC without requiring direct access to those resources or to relevant credentials.
[Cloud organization audit logs](../cockroachcloud/cloud-org-audit-logs.html) | You can now [export information on your team’s actions](../cockroachcloud/cloud-org-audit-logs.html) in your Cloud organization, e.g., managing users and their access, creating and deleting clusters, and configuring IP allowlisting. You can access these logs as needed, or you can create simple pull-based clients to incrementally send those to your Security Information and Event Management (SIEM) tools.

<h4 id="v22-2-0-backward-incompatible-changes">Backward-incompatible changes</h4>

Before [upgrading to CockroachDB v22.2](../v22.2/upgrade-cockroach-version.html), be sure to review the following backward-incompatible changes and adjust your deployment as necessary.

{% include v22.2/backward-incompatible/alpha.1.md %}

<h4 id="v22-2-0-deprecations">Deprecations</h4>

- `debug zip`'s `--redact-logs` flag has been deprecated in favor of the `--redact` flag, which applies to a broader scope than just logs, and also includes logs. The new `--redact` flag triggers the redaction of all sensitive data in debug zip bundles, with the exception of range keys. Range keys must remain unredacted because they are essential to support CockroachDB. The `--redact-logs` flag is still available but displays a redaction warning and is interpreted as `--redact` instead. [#88266][#88266]
- Using a single TCP port listener for both RPC (node-node) and SQL client connections is now deprecated. This capability **will be removed** in the next version of CockroachDB. Instead, make one of the following configuration changes to your CockroachDB deployment:
    - Preferred: keep port `26257` for SQL, and allocate a new port, e.g., `26357`, for node-node RPC connections. For example, you might configure a node with the flags `--listen-addr=:26357 --sql-addr=:26257`, where subsequent nodes seeking to join would then use the flag `--join=othernode:26357,othernode:26257`. This will become the default configuration in the next version of CockroachDB. When using this mode of operation, care should be taken to use a `--join` flag that includes both the previous and new port numbers for other nodes, so that no network partition occurs during the upgrade.
    - Optional: keep port `26257` for RPC, and allocate a new port, e.g., `26357`, for SQL connections. For example, you might configure a node with the flags `--listen-addr=:26257 --sql-addr=:26357`. When using this mode of operation, the `--join` flags do not need to be modified. However, SQL client apps or the SQL load balancer configuration (when in use) must be updated to use the new SQL port number. [#85671][#85671]
- Previously, [`BACKUP`](../v22.2/backup.html) allowed the user to specify a custom subdirectory name for their backups via `BACKUP .. INTO {subdir} IN {collectionURI}`. This is no longer supported. Users can only create a full backup via `BACKUP ... INTO {collectionURI}` or an incremental backup on the latest full backup in their collection via `BACKUP ... INTO LATEST IN {collectionURI}`. This deprecation also removes the need to address a bug in `SHOW BACKUPS IN`, which cannot display user-defined subdirectories. [#79447][#79447]
- The `debug unsafe-remove-dead-replicas` CLI command has been deprecated, and will be removed in v23.1. Users should use the new `debug recover` set of commands instead. [#88765][#88765]
- The `GRANT` privilege has been removed and replaced by the more granular [`WITH GRANT OPTION`](../v22.2/grant.html#grant-privileges-with-the-option-to-grant-to-others), which provides control over which privileges are allowed to be granted. [#81310][#81310]

<h4 id="v22-2-0-known-limitations">Known limitations</h4>

For information about new and unresolved limitations in CockroachDB v22.2, with suggested workarounds where applicable, see [Known Limitations](../v22.2/known-limitations.html).

<h4 id="v22-2-0-additional-resources">Additional resources</h4>

Resource             | Topic                                      | Description
---------------------+--------------------------------------------+-------------
Cockroach University | [Getting Started with SQL for Application Developers](https://university.cockroachlabs.com/courses/course-v1:crl+getting-started-with-sql-for-app-devs+self-paced/about) | In this course, you will learn some basic, single-table, SQL operations. Starting from a business use case, you will learn how to translate a simple entity/object into a corresponding database table. From there, you will see how you can populate that table with data and retrieve it afterward. By the end of the course, you should feel comfortable with taking your own simple entities, mapping them to your relational database, and performing basic queries.
Cockroach University | [Modeling Object Relationships in SQL](https://university.cockroachlabs.com/courses/course-v1:crl+modeling-object-relationships-in-sql+preview/about) </br>(Preview) | In this course, you will learn to map your business critical data from your application code to a SQL database efficiently and elegantly, and learn key SQL features to help minimize application complexity.
Cockroach University | [Getting Started with Node.js and node-postgres](https://university.cockroachlabs.com/courses/course-v1:crl+getting-started-with-nodejs-node-postgres+self-paced/about) | In this course, you will be learning how to properly use CockroachDB inside of a simple microservice. You will start with a pre-built microservice and add the necessary components to communicate with the database using the node-postgres driver.
Cockroach University | [Intro to Multi-Region Databases in Geo-distributed Applications](https://university.cockroachlabs.com/courses/course-v1:crl+intro-to-multi-region+v1/about) </br>(Preview) | This course will introduce simple, elegant, and practical solutions for designing a database that optimizes for resilience, responsiveness while also being sensitive to data locality.
Docs                 | [Migration Overview](../v22.2/migration-overview.html) | This page summarizes the steps of migrating a database to CockroachDB, which include testing and updating your schema to work with CockroachDB, moving your data into CockroachDB, and testing and updating your application.
Docs                 | [Unsupported Features in CockroachDB Serverless](../cockroachcloud/serverless-unsupported-features.html) |  This page describes the features that are either unsupported or partially supported in CockroachDB serverless clusters
Docs                 | [Sample apps with ccloud](../v22.2/build-a-nodejs-app-with-cockroachdb.html?filters=ccloud) | Sample application docs now includes steps to create a {{ site.data.products.serverless }} cluster using the `ccloud` CLI tool.
Docs                 | [API Support Policy](../v22.2/api-support-policy.html) | This page includes the following information: our API support policies, our definitions of backward-incompatible and backward-compatible changes, and a summary of APIs that CockroachDB makes available.
Docs                 | [CockroachDB Kubernetes Operator release notes](../releases/kubernetes-operator.html) | The CockroachDB Kubernetes Operator-specific release notes are now surfaced on this page.
Docs                 | [HashiCorp Vault tutorial](../v22.2/vault-db-secrets-tutorial.html) | This pages reviews the supported integrations between CockroachDB and HashiCorp's Vault, which offers tooling to extend CockroachDB's data security capabilities.
Docs                 | [Backup architecture](../v22.2/backup-architecture.html) | This page describes the backup job workflow with a high-level overview, diagrams, and more details on each phase of the job.
