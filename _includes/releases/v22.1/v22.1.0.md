## v22.1.0

Release Date: May 24, 2022

With the release of CockroachDB v22.1, we've made a variety of management, performance, security, and compatibility improvements. Check out a [summary of the most significant user-facing changes](#v22-1-0-feature-summary) and then [upgrade to CockroachDB v22.1](../v22.1/upgrade-cockroach-version.html). For a release announcement with further focus on key features, see the [v22.1 blog post](https://www.cockroachlabs.com/blog/cockroachdb-22-1-release/).

We're running a packed [schedule of launch events](https://www.cockroachlabs.com/cockroachdb-22-1-launch/) over the next few weeks, which include two opportunities to win limited-edition swag. Join our [Office Hours session](https://www.cockroachlabs.com/webinars/22-1-release-office-hours) for all your questions, a [coding livestream](http://twitch.tv/itsaydrian) where we'll play with new features, and a [live talk on building and preparing for scale](https://www.cockroachlabs.com/webinars/scale-happens).

{% include releases/release-downloads-docker-image.md release=include.release %}

<h3 id="v22-1-0-{{ site.data.products.db | downcase | replace: " ", "-" }}">{{ site.data.products.db }}</h3>

- <a href="https://cockroachlabs.cloud/signup?referralId=docs_crdb_release_notes" rel="noopener" target="_blank">Get a free v22.1 cluster on {{ site.data.products.serverless }}</a>.
- Learn about recent updates to {{ site.data.products.db }} in the [{{ site.data.products.db }} Release Notes](cloud.html).

<h3 id="v22-1-0-feature-summary">Feature summary</h3>

TODO: Insert WIP content from [this spreadsheet](https://docs.google.com/spreadsheets/d/1DTDZoVLhxPFqETw4bFzwmnQI1vQ3N3G5WiC4y-NIZik/edit).

This section summarizes the most significant user-facing changes in v22.1.0. For a complete list of features and changes, including bug fixes and performance improvements, see the [release notes](index.html#testing-releases) for previous testing releases. You can also search for [what's new in v22.1 in our docs](../search.html?query=new%20in%20v22.1).

{{site.data.alerts.callout_info}}
"Core" features are freely available in the core version of CockroachDB and do not require an enterprise license. "Enterprise" features require an [enterprise license](https://www.cockroachlabs.com/get-cockroachdb/enterprise). [{{ site.data.products.db }} clusters](https://cockroachlabs.cloud/) include all enterprise features. You can also use [`cockroach demo`](../v22.1/cockroach-demo.html) to test enterprise features in a local, temporary cluster.
{{site.data.alerts.end}}

- [SQL](#v22-1-0-sql)
- [Recovery and I/O](#v22-1-0-recovery-and-i-o)
- [Database operations](#v22-1-0-database-operations)
- [Backward-incompatible changes](#v22-1-0-backward-incompatible-changes)
- [Deprecations](#v22-1-0-deprecations)
- [Known limitations](#v22-1-0-known-limitations)
- [Education](#v22-1-0-education)

<style>
    table td:first-child {
        min-width: 100px !important;
    }
    table td:nth-child(2) {
        min-width: 200px !important;
    }
</style>

<h4 id="v22-1-0-sql">SQL</h4>

Version    | Feature                        | Description
-----------+--------------------------------+------------------------------

<h4 id="v22-1-0-recovery-and-i-o">Recovery and I/O</h4>

Version    | Feature                                       | Description
-----------+-----------------------------------------------+------------

<h4 id="v22-1-0-database-operations">Database operations</h4>

Version    | Feature                                | Description
-----------+----------------------------------------+------------

<h4 id="v22-1-0-backward-incompatible-changes">Backward-incompatible changes</h4>

Before [upgrading to CockroachDB v22.1](../v22.1/upgrade-cockroach-version.html), be sure to review the following backward-incompatible changes and adjust your deployment as necessary.

- Using [`SESSION_USER`](../v22.1/functions-and-operators.html#special-syntax-forms) in a projection or `WHERE` clause now returns the `SESSION_USER` instead of the `CURRENT_USER`. For backward compatibility, use [`session_user()`](../v22.1/functions-and-operators.html#system-info-functions) for `SESSION_USER` and `current_user()` for `CURRENT_USER`. [#70444][#70444]
- Placeholder values (e.g., `$1`) can no longer be used for role names in [`ALTER ROLE`](../v22.1/alter-role.html) statements or for role names in [`CREATE ROLE`](../v22.1/create-role.html)/[`DROP ROLE`](../v22.1/drop-role.html) statements. [#71498][#71498]
- Non-standard [`cron`](https://en.wikipedia.org/wiki/Cron) expressions that specify seconds or year fields are no longer supported. [#74881][#74881]
- [Changefeeds](../dev/use-changefeeds.html) will now filter out [virtual computed columns](../dev/computed-columns.html) from events by default. [#74916][#74916]
- The [environment variable](../v22.1/cockroach-commands.html#environment-variables) that controls the max amount of CPU that can be taken by password hash computations during authentication was renamed from `COCKROACH_MAX_BCRYPT_CONCURRENCY` to `COCKROACH_MAX_PW_HASH_COMPUTE_CONCURRENCY`. Its semantics remain unchanged. [#74301][#74301]
- The volatility of cast operations between [strings](../v22.1/string.html) and [intervals](../v22.1/interval.html) or [timestamps](../v22.1/timestamp.html) has changed from immutable to stable. This means that these cast operations can no longer be used in computed columns or partial index definitions. Instead, use the following [built-in functions:](../v22.1/functions-and-operators.html) `parse_interval`, `parse_date`, `parse_time`, `parse_timetz`, `parse_timestamp`, or `to_char`. Upon upgrade to v22.1, CockroachDB will automatically rewrite any computed columns or partial indexes that use the affected casts to use the new built-in functions. [#78455][#78455]
- Users can no longer define the subdirectory of their full backup. This deprecated syntax can be enabled by changing the new `bulkio.backup.deprecated_full_backup_with_subdir` [cluster setting](../v22.1/cluster-settings.html) to `true`. [#80145][#80145]

<h4 id="v22-1-0-deprecations">Deprecations</h4>

- The [`cockroach node drain`](../v22.1/cockroach-node.html) command is now able to drain a node by ID, specified on the command line, from another node in the cluster. It now also supports the flag `--self` for symmetry with [`node decommission`](../v22.1/cockroach-node.html#node-decommission). Using `node drain` without either `--self` or a node ID is now deprecated. [#73991][#73991]
- The flag `--self` of the [`cockroach node decommission` command](../v22.1/cockroach-node.html) is deprecated. Instead, operators should specify the node ID of the target node as an explicit argument. The node that the command is connected to should not be a target node. [#74319][#74319]
- The `experimental_enable_hash_sharded_indexes` session variable is deprecated as hash-sharded indexes are enabled by default. Enabling this setting results in a noop. [#78038][#78038]
- The [`BACKUP TO`](../v22.1/backup.html) syntax to take backups is deprecated, and will be removed in a future release. Create a backup collection using the `BACKUP INTO` syntax. [#78250][#78250]
- Users can no longer define the subdirectory of their full backup. This deprecated syntax can be enabled by changing the new `bulkio.backup.deprecated_full_backup_with_subdir` [cluster setting](../v22.1/cluster-settings.html) to `true`. [#80145][#80145]
- `SHOW BACKUP` without the `IN` keyword to specify a subdirectory is deprecated and will be removed from a future release. Users are recommended to only create collection based backups and view them with `SHOW BACKUP FROM <backup> IN <collection>`. [#79116][#79116]
- Using the [`RESTORE FROM`](../v22.1/restore.html) syntax without an explicit subdirectory pointing to a backup in a collection is deprecated, and will be removed in a future release. Use `RESTORE FROM <backup> IN <collection>` to restore a particular backup in a collection. [#78250][#78250]

<h4 id="v22-1-0-known-limitations">Known limitations</h4>

For information about new and unresolved limitations in CockroachDB v22.1, with suggested workarounds where applicable, see [Known Limitations](../v22.1/known-limitations.html).

<h4 id="v22-1-0-education">Education</h4>

Area                 | Topic                     | Description
---------------------+---------------------------+------------
